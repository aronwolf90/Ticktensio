FROM node:10.6.0-alpine

FROM ruby:2.5.1-alpine3.7

ARG UID=0
ARG GID=0
ARG USER_NAME=root

RUN echo "test"
RUN echo $UID

WORKDIR  /app

ENV PATH /app/bin:/root/.yarn/bin:$PATH
ENV BUNDLE_BIN /app/bin
ENV HISTFILE=/app/tmp/bash_history
ENV YARN_VERSION 1.7.0

RUN apk update
RUN apk add rsync less shadow
RUN mkdir /tmp/local
COPY --from=0 /usr/local /tmp/local
RUN rsync -a /tmp/local/ /usr/local

COPY alphine_minimum_shared_install.sh ./
COPY alphine_shared_install.sh ./
RUN /app/alphine_shared_install.sh

RUN echo 'export PATH="/app/bin:$PATH"' >> /etc/profile

RUN yarn global add eslint eslint-config-standard \
  eslint-plugin-import \
  eslint-plugin-node \
  eslint-plugin-standard \
  eslint-config-standart \
  eslint-plugin-promise \
  eslint-plugin-vue

RUN apk add vim tmux

RUN chown -R $UID /usr/local/bundle
RUN chown -R $UID /usr/local/bundle

RUN usermod -m -d /user node
USER $UID:$GID

RUN git clone https://github.com/VundleVim/Vundle.vim.git /user/.vim/bundle/Vundle.vim
COPY .tmux.conf /user/.tmux.conf
COPY .vimrc /user/.vimrc
RUN vim +PluginInstall +qall

FROM ruby:2.4.2-alpine3.7

WORKDIR  /app

ENV PATH /root/.yarn/bin:$PATH
ENV BUNDLE_BIN /app/bin

COPY alphine_minimum_shared_install.sh ./
COPY alphine_shared_install.sh ./
RUN /app/alphine_shared_install.sh

COPY Gemfile Gemfile.lock ./
RUN bundle install

COPY yarn.lock package.json ./
RUN yarn install

COPY . /app

# speed up tests on gitlab-ci
RUN mkdir -p /root/node_modules
RUN cp -R node_modules /root/

